users.each_with_index do |u, index|
  # some code
  if index == users.size - 1
    # code for the last user
  end
end

begin
  this_will_fail!
rescue Failure => error
  log.error error.message
  raise
end
